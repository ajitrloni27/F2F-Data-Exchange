<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Farmer System ‚Äî Auth First</title>
<style>
:root{
  --green:#2c7a2c;
  --bg:#f5f5f5;
  --card:#fff;
  --text:#222;
  --border:#ccc;
}
body{
  background:var(--bg);
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  color:var(--text);
}
nav{
  padding:12px 20px;
  background:var(--card);
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
nav button{
  background:var(--green);
  border:none;
  padding:8px 14px;
  border-radius:6px;
  color:white;
  cursor:pointer;
  font-weight:bold;
}
.profile-icon{
  width:40px;height:40px;
  border-radius:50%;
  background:var(--green);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
}
.page{
  display:none;
  max-width:620px;
  margin:auto;
  padding:20px;
}
.card{
  background:var(--card);
  padding:18px;
  border-radius:10px;
  border:1px solid var(--border);
  margin-bottom:12px;
}
input,textarea,select{
  width:100%;
  padding:10px;
  border-radius:6px;
  border:1px solid var(--border);
  margin-bottom:12px;
  box-sizing:border-box;
}
button{
  padding:10px 16px;
  border:none;
  border-radius:6px;
  background:var(--green);
  color:white;
  cursor:pointer;
  font-size:16px;
}
.post{
  padding:14px;border-radius:10px;background:white;border:1px solid var(--border);margin-bottom:14px;
}
.post .meta{
  display:flex;
  gap:8px;
  align-items:center;
  margin-top:8px;
}
.post .meta button{
  background:transparent;
  color:var(--green);
  border:1px solid var(--green);
  padding:6px 8px;
  border-radius:6px;
  cursor:pointer;
}
.post .meta .danger{
  border-color:#c0392b;
  color:#c0392b;
}
.post .counts{
  margin-left:8px;
  font-size:14px;
  color:#444;
}

/* ‚≠ê COMMENTS SPACING ADDED ‚≠ê */
.comment-area{
  margin-top:10px;
  padding:10px;
  background:#fafafa;
  border-radius:6px;
  border:1px solid #eee;
  margin-bottom:18px;
}
.comment{
  margin-bottom:12px;
  padding-bottom:10px;
  border-bottom:1px dashed #ddd;
}
.comment:last-child{
  margin-bottom:12px;
  border-bottom:none;
}

.small{
  font-size:13px;color:#666;
}
.popup{
  position:fixed;left:50%;top:50%;
  transform:translate(-50%,-50%);
  background:var(--card);
  padding:18px;border-radius:10px;border:1px solid var(--border);display:none;width:300px;
}
</style>
</head>

<body>

<!-- REGISTER PAGE -->
<div id="registerPage" class="page" style="display:block;">
  <div class="card">
    <select id="langSelector" onchange="changeLang(this.value)" style="width:150px;padding:8px;margin-bottom:10px;">
      <option value="en">English</option>
      <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
    </select>

    <h2 id="regTitle">Register</h2>
    <input id="regName" placeholder="Full Name">
    <input id="regPhone" placeholder="Phone Number">
    <input id="regPass" placeholder="Password" type="password">
    <button onclick="registerUser()" id="regBtn">Register</button>

    <p style="text-align:center;">
      <span id="regHaveAcc">Already have an account?</span>
      <a href="#" onclick="showPage('loginPage')" id="regLoginLink">Login</a>
    </p>
  </div>
</div>

<!-- LOGIN PAGE -->
<div id="loginPage" class="page">
  <div class="card">
    <select id="langSelector2" onchange="changeLang(this.value)" style="width:150px;padding:8px;margin-bottom:10px;">
      <option value="en">English</option>
      <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
    </select>

    <h2 id="loginTitle">Login</h2>
    <input id="loginPhone" placeholder="Phone Number">
    <input id="loginPass" placeholder="Password" type="password">
    <button onclick="login()" id="loginBtn">Login</button>

    <p style="text-align:center;">
      <span id="loginNewUser">New user?</span>
      <a href="#" onclick="showPage('registerPage')" id="loginRegLink">Register</a>
    </p>

    <p style="text-align:center;">
      <a href="#" onclick="showPage('forgotPage')" id="forgotLink">Forgot Password?</a>
    </p>
  </div>
</div>

<!-- FORGOT PASSWORD PAGE -->
<div id="forgotPage" class="page">
  <div class="card">
    <h2 id="fpTitle">Reset Password</h2>
    <input id="fpPhone" placeholder="Enter Phone Number">
    <input id="fpNewPass" placeholder="Enter New Password" type="password">
    <button onclick="resetPassword()" id="fpBtn">Reset Password</button>

    <p style="text-align:center;">
      <a href="#" onclick="showPage('loginPage')" id="fpBack">Back to Login</a>
    </p>
  </div>
</div>

<!-- NAVBAR -->
<nav id="navbar" style="display:none;">
  <div>
    <button onclick="showMain('home')">Home</button>
    <button onclick="showMain('create')">Create</button>
    <button onclick="showMain('people')">People</button>
  </div>

  <div style="display:flex;gap:12px;align-items:center;">
    <div class="profile-icon" id="navProfileIcon" onclick="showMain('profile')">üë§</div>
    <button onclick="logout()">Logout</button>
  </div>
</nav>

<!-- HOME PAGE -->
<div id="home" class="page">
  <h2>Community Posts</h2>
  <div id="postsList"></div>
</div>

<!-- CREATE PAGE -->
<div id="create" class="page">
  <h2>Create Post</h2>
  <input id="crop" placeholder="Crop name">
  <textarea id="text" placeholder="Write your post..."></textarea>
  <input id="imgFile" type="file" accept="image/*">
  <button onclick="createPost()">Post</button>
</div>

<!-- PEOPLE PAGE -->
<div id="people" class="page">
  <h2>All Farmers</h2>
  <div id="peopleList"></div>
</div>

<!-- PROFILE PAGE -->
<div id="profile" class="page">
  <h2>Your Profile</h2>
  <div class="card" style="text-align:center;">
    <div id="profileAvatar" class="profile-icon" style="width:90px;height:90px;font-size:36px;margin:auto;">üë§</div>
    <input id="profilePic" type="file" accept="image/*" onchange="uploadPic()">
  </div>

  <div class="card">
    <label>Name</label>
    <input id="editName">
    <label>Phone</label>
    <input id="editPhone" disabled>
    <label>New Password</label>
    <input id="editPass" type="password">
    <button onclick="saveProfile()">Save</button>
  </div>
</div>

<div id="likePopup" class="popup">
  <h3>People who liked</h3>
  <div id="likeNames"></div><br>
  <button onclick="closePopup()">Close</button>
</div>

<script>
/* DATA */
let users = [];
let posts = [];
let logged = null;

/* LANGUAGE TEXT */
const text = { 
  en:{regTitle:"Register",regName:"Full Name",regPhone:"Phone Number",regPass:"Password",
      regBtn:"Register",regHaveAcc:"Already have an account?",regLogin:"Login",
      loginTitle:"Login",loginPhone:"Phone Number",loginPass:"Password",loginBtn:"Login",
      loginNew:"New user?",loginReg:"Register",forgot:"Forgot Password?",
      fpTitle:"Reset Password",fpPhone:"Enter Phone Number",fpNewPass:"Enter New Password",
      fpBtn:"Reset Password",fpBack:"Back to Login"},
  kn:{regTitle:"‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø",regName:"‡≤™‡≥Ç‡≤∞‡≥ç‡≤£ ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å",regPhone:"‡≤´‡≥ã‡≤®‡≥ç ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü",regPass:"‡≤™‡≤æ‡≤∏‡≥ç‡≤µ‡≤∞‡≥ç‡≤°‡≥ç",
      regBtn:"‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø",regHaveAcc:"‡≤à‡≤ó‡≤æ‡≤ó‡≤≤‡≥á ‡≤ñ‡≤æ‡≤§‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≤æ?",regLogin:"‡≤≤‡≤æ‡≤ó‡≤ø‡≤®‡≥ç",
      loginTitle:"‡≤≤‡≤æ‡≤ó‡≤ø‡≤®‡≥ç",loginPhone:"‡≤´‡≥ã‡≤®‡≥ç ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü",loginPass:"‡≤™‡≤æ‡≤∏‡≥ç‡≤µ‡≤∞‡≥ç‡≤°‡≥ç",loginBtn:"‡≤≤‡≤æ‡≤ó‡≤ø‡≤®‡≥ç",
      loginNew:"‡≤π‡≥ä‡≤∏ ‡≤¨‡≤≥‡≤ï‡≥Ü‡≤¶‡≤æ‡≤∞?",loginReg:"‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø",forgot:"‡≤™‡≤æ‡≤∏‡≥ç‡≤µ‡≤∞‡≥ç‡≤°‡≥ç ‡≤Æ‡≤∞‡≥Ü‡≤§‡≤ø‡≤∞‡≤æ?",
      fpTitle:"‡≤™‡≤æ‡≤∏‡≥ç‡≤µ‡≤∞‡≥ç‡≤°‡≥ç ‡≤¨‡≤¶‡≤≤‡≤æ‡≤Ø‡≤ø‡≤∏‡≤ø",fpPhone:"‡≤´‡≥ã‡≤®‡≥ç ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü ‡≤®‡≤Æ‡≥Ç‡≤¶‡≤ø‡≤∏‡≤ø",fpNewPass:"‡≤π‡≥ä‡≤∏ ‡≤™‡≤æ‡≤∏‡≥ç‡≤µ‡≤∞‡≥ç‡≤°‡≥ç ‡≤®‡≤Æ‡≥Ç‡≤¶‡≤ø‡≤∏‡≤ø",
      fpBtn:"‡≤™‡≤æ‡≤∏‡≥ç‡≤µ‡≤∞‡≥ç‡≤°‡≥ç ‡≤¨‡≤¶‡≤≤‡≤æ‡≤Ø‡≤ø‡≤∏‡≤ø",fpBack:"‡≤Æ‡≤§‡≥ç‡≤§‡≥Ü ‡≤≤‡≤æ‡≤ó‡≤ø‡≤®‡≥ç ‡≤ó‡≥Ü"}
};

const el = id => document.getElementById(id);

/* APPLY LANGUAGE */
function changeLang(lang){
  if(!lang) lang = el('langSelector')?.value || 'en';
  if(!text[lang]) lang='en';
  const t=text[lang];

  el('regTitle').innerText=t.regTitle;
  el('regName').placeholder=t.regName;
  el('regPhone').placeholder=t.regPhone;
  el('regPass').placeholder=t.regPass;
  el('regBtn').innerText=t.regBtn;
  el('regHaveAcc').innerText=t.regHaveAcc;
  el('regLoginLink').innerText=t.regLogin;
  
  el('loginTitle').innerText=t.loginTitle;
  el('loginPhone').placeholder=t.loginPhone;
  el('loginPass').placeholder=t.loginPass;
  el('loginBtn').innerText=t.loginBtn;
  el('loginNewUser').innerText=t.loginNew;
  el('loginRegLink').innerText=t.loginReg;
  el('forgotLink').innerText=t.forgot;
  
  el('fpTitle').innerText=t.fpTitle;
  el('fpPhone').placeholder=t.fpPhone;
  el('fpNewPass').placeholder=t.fpNewPass;
  el('fpBtn').innerText=t.fpBtn;
  el('fpBack').innerText=t.fpBack;
}

/* PAGE SWITCH */
function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  if(id!=='registerPage' && id!=='loginPage' && id!=='forgotPage')
    el('navbar').style.display='flex';
  else el('navbar').style.display='none';
  el(id).style.display='block';
}

/* MAIN NAV */
function showMain(id){
  if(!logged) return alert("Please login");
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  el(id).style.display='block';
  el('navbar').style.display='flex';

  if(id==='home') renderPosts();
  if(id==='people') renderPeople();
  if(id==='profile') renderProfile();
  if(id==='create'){
    el('crop').value='';
    el('text').value='';
    el('imgFile').value='';
  }
}

/* REGISTER */
function registerUser(){
  let name=el('regName').value.trim(),
      phone=el('regPhone').value.trim(),
      pass=el('regPass').value.trim();
  if(!name||!phone||!pass) return alert("Fill all fields");
  if(users.find(u=>u.phone===phone)) return alert("Phone exists");
  users.push({name,phone,pass,photo:null});
  alert("Registered!");
  showPage("loginPage");
}

/* LOGIN */
function login(){
  const p=el('loginPhone').value.trim(),
        pw=el('loginPass').value.trim();
  let u=users.find(x=>x.phone===p && x.pass===pw);
  if(!u) return alert("Incorrect details");
  logged=u;
  updateNavAvatar();
  showMain('home');
}

/* RESET PASSWORD */
function resetPassword(){
  const ph=el('fpPhone').value.trim(),
        np=el('fpNewPass').value.trim();
  let u=users.find(x=>x.phone===ph);
  if(!u) return alert("Phone not found");
  u.pass=np;
  alert("Password updated");
  showPage("loginPage");
}

/* LOGOUT */
function logout(){
  logged=null;
  showPage("loginPage");
}

/* CREATE POST */
function createPost(){
  if(!logged) return alert("Login required");
  let crop=el('crop').value.trim(),
      textP=el('text').value.trim(),
      img="";
  if(el('imgFile').files[0])
    img=URL.createObjectURL(el('imgFile').files[0]);

  posts.unshift({
    id:Date.now(),
    farmerName:logged.name,
    farmerPhone:logged.phone,
    crop,
    text:textP,
    img,
    likes:[],
    dislikes:[],
    comments:[]
  });

  showMain('home');
}

/* RENDER POSTS ‚Äî COMMENTS ALWAYS VISIBLE (OPTION B) */
function renderPosts(){
  const box=el('postsList');
  box.innerHTML="";

  posts.forEach(p=>{
    const imgHtml = p.img ? `<img src="${p.img}" style="width:100%;border-radius:6px;margin-top:8px;">` : "";

    const commentsHtml = p.comments.length
      ? p.comments.map(c=>`
        <div class="comment">
          <b>${escapeHtml(c.name)}</b><br>
          <span class="small">${escapeHtml(c.text)}</span>
        </div>`).join("")
      : `<div class="small">No comments yet</div>`;

    const owner = (logged && logged.phone===p.farmerPhone)
      ? `<button class="danger" onclick="deletePost(${p.id})">üóë Delete</button>`
      : "";

    box.innerHTML += `
      <div class="post">

        <b>${escapeHtml(p.farmerName)}</b><br>
        ${p.crop ? `<small>Crop: ${escapeHtml(p.crop)}</small><br>` : ""}
        <p>${escapeHtml(p.text)}</p>
        ${imgHtml}

        <div class="meta">
          <button onclick="likePost(${p.id})">üëç Like</button>
          <span class="counts">${p.likes.length}</span>

          <button onclick="dislikePost(${p.id})">üëé Dislike</button>
          <span class="counts">${p.dislikes.length}</span>

          <!-- ‚≠ê COMMENT COUNT ONLY (No button, always open) -->
          üí¨ <span class="counts">${p.comments.length} Comments</span>

          ${owner}
        </div>

        <!-- ‚≠ê COMMENT AREA ALWAYS OPEN -->
        <div class="comment-area">
          <div id="comments-${p.id}">
            ${commentsHtml}
          </div>
          <div style="display:flex;gap:8px;margin-top:10px;">
            <input id="cinput-${p.id}" placeholder="Write a comment..." style="flex:1;">
            <button onclick="addComment(${p.id})">Post</button>
          </div>
        </div>

      </div>
    `;
  });
}

/* LIKE */
function likePost(id){
  let p=posts.find(x=>x.id===id);
  if(!p.likes.includes(logged.phone)) p.likes.push(logged.phone);
  p.dislikes = p.dislikes.filter(d=>d!==logged.phone);
  renderPosts();
}

/* DISLIKE */
function dislikePost(id){
  let p=posts.find(x=>x.id===id);
  if(!p.dislikes.includes(logged.phone)) p.dislikes.push(logged.phone);
  p.likes = p.likes.filter(l=>l!==logged.phone);
  renderPosts();
}

/* ADD COMMENT */
function addComment(id){
  let p=posts.find(x=>x.id===id);
  let txt=el("cinput-"+id).value.trim();
  if(!txt) return;
  p.comments.push({name:logged.name, text:txt});
  el("cinput-"+id).value="";
  renderPosts();
}

/* DELETE POST */
function deletePost(id){
  if(!confirm("Delete post?")) return;
  posts = posts.filter(p=>p.id!==id);
  renderPosts();
}

/* PEOPLE */
function renderPeople(){
  let box=el('peopleList');
  box.innerHTML="";
  users.forEach(u=>{
    box.innerHTML += `<div class="post"><b>${escapeHtml(u.name)}</b><br><small>******${u.phone.slice(-2)}</small></div>`;
  });
}

/* PROFILE */
function renderProfile(){
  el('editName').value=logged.name;
  el('editPhone').value=logged.phone;
  el('profileAvatar').innerText=logged.name.charAt(0).toUpperCase();
}
function uploadPic(){}
function saveProfile(){}

/* NAV AVATAR */
function updateNavAvatar(){
  el('navProfileIcon').innerText = logged.name.charAt(0).toUpperCase();
}

/* ESCAPE HTML */
function escapeHtml(s){++++++++++






  
  return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

/* START */
showPage("registerPage");
changeLang();
</script>

</body>
</html>
